## Codebase Patterns
- Backend uses TypeDI for dependency injection - all services decorated with @Service()
- Controllers use routing-controllers decorators and auto-register via glob import
- LanceDB is used for vector database with auto-generated embeddings via EmbeddingService
- OpenAI integration exists via EmbeddingService - similar pattern should be used for AI tag generation
- All API endpoints use @CurrentUser() decorator for protected routes
- DTOs are in packages/dto/ and shared between frontend and backend
- Frontend uses @rabjs/react for reactive state management
- API calls are abstracted in apps/web/src/services/ and apps/web/src/api/
- Services extend @rabjs/react Service class for reactive state
- When adding new DTOs: 1) Update packages/dto/src/, 2) Rebuild DTO package, 3) Import from @aimo/dto

---

## 2026-02-24T12:00:00Z - US-003
- Implemented AI tools architecture extension support
- Files changed:
  - apps/web/src/api/ai.ts (new) - API layer for AI endpoints
  - apps/web/src/services/ai-tools.service.ts (new) - AIToolsService with extensible tool configuration
  - apps/server/src/controllers/v1/ai.controller.ts - Added GET /api/v1/ai/tools endpoint
- **Learnings for future iterations:**
  - AIToolsService is the central place for AI tool state management
  - Tool definitions are in the `tools` array - add new tools there for automatic UI rendering
  - AIToolType union type defines all available tools - add new types there
  - Reserved slots documented for future tools: summarize, translate, expand, grammar-check
  - Modal state tracks which tool is currently active
  - Tag generation state is separate and includes loading, suggestedTags, selectedTags, error
  - Pattern for adding new AI tool: 1) Add to AIToolType, 2) Add to tools array, 3) Add tool-specific state if needed, 4) Add API method, 5) Add backend endpoint
---

## 2026-02-24T13:30:00Z - US-007
- Implemented tag secondary editing functionality
- Files changed:
  - apps/web/src/components/ai/tag-generator-modal.tsx - Added inline editing with input field, edit/save/cancel handlers, edit/delete buttons on hover
  - apps/web/src/services/ai-tools.service.ts - Enhanced updateTag to sync suggestedTags, added deleteTag method
- **Learnings for future iterations:**
  - Tag editing uses local component state (editingTag, editValue) separate from service state
  - Edit input auto-focuses via useEffect when entering edit mode
  - Edit/delete buttons use opacity-0/group-hover:opacity-100 pattern for hover reveal
  - updateTag now syncs both selectedTags and suggestedTags to keep UI consistent
  - deleteTag removes from both arrays (complete removal vs removeTag which just deselects)
  - Keyboard handling: Enter to save, Escape to cancel, onBlur saves
  - Duplicate prevention is handled in service layer (updateTag, addCustomTag)
---

## 2026-02-24T14:00:00Z - US-008
- Implemented Frontend tag confirmation and submission
- Files changed:
  - apps/web/src/services/ai-tools.service.ts - Enhanced saveTags method to show toast notifications and update MemoService state
- **Learnings for future iterations:**
  - Use `toast.success()` and `toast.error()` from toast.service.ts for user feedback
  - Use `resolve(MemoService)` from @rabjs/react to access other services for state updates
  - The saveTags method updates both the memos list and shows appropriate toast notifications
  - Loading state `isSaving` prevents duplicate submissions while API call is in progress
  - Error handling shows toast error and preserves user selection state for retry
---

## 2026-02-24T15:00:00Z - US-001
- Implemented display tags on memo cards
- Files changed:
  - apps/web/src/pages/home/components/memo-card.tsx - Added renderTags function to display tags as hashtags with click handling
  - apps/web/src/services/memo.service.ts - Added tagFilter state and setTagFilter method
  - apps/server/src/controllers/v1/memo.controller.ts - Added tag query parameter to getMemos endpoint
  - apps/server/src/services/memo.service.ts - Added tag filtering logic using tag IDs (AND logic for multiple tags)
  - packages/dto/src/memo.ts - Added tag and tags fields to MemoSearchOptionsDto
- **Learnings for future iterations:**
  - Tags are stored as tagIds in LanceDB, not tag names - need to resolve names to IDs for filtering
  - Tag filtering uses AND logic (memo must have ALL specified tags)
  - renderTags function is placed at the beginning of the content section, before the memo text
  - Tags have distinct visual styling with primary color (blue) background and hover effects
  - DTO changes require rebuilding the @aimo/dto package before they're available in other packages
  - LanceDB filtering: SQL WHERE clause for basic filters, JavaScript filter for complex logic like tag matching
---

## 2026-02-24T15:30:00Z - US-002
- Implemented tag list component for sidebar
- Files changed:
  - apps/web/src/api/tag.ts (new) - API layer for tag endpoints
  - apps/web/src/services/tag.service.ts (new) - TagService for state management
  - apps/web/src/pages/home/components/tag-list.tsx (new) - TagList component with sidebar integration
  - apps/web/src/pages/home/home.tsx - Added TagList component below DailyRecommendations
- **Learnings for future iterations:**
  - Tags are sorted by usageCount (descending) in TagService.fetchTags()
  - TagList has 300px max-height with overflow-y-auto for scrolling
  - Empty state shows "暂无标签" when no tags exist
  - Toggle behavior: clicking selected tag clears filter, clicking new tag switches filter
  - Selected state uses primary-50 background with primary-700 text
  - Tag count shown in parentheses next to tag name
  - Tag icon from lucide-react used for section header
---
