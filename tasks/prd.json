{
  "project": "AIMO Chrome Extension",
  "branchName": "ralph/chrome-extension",
  "description": "AIMO Chrome 浏览器扩展 - 快速提取和保存网页内容到 AIMO 知识库",
  "userStories": [
    {
      "id": "US-001",
      "title": "项目初始化和基础配置",
      "description": "作为开发者，我需要创建 Chrome 扩展的基础项目结构和配置，以便后续功能开发。",
      "acceptanceCriteria": [
        "创建 apps/extension/ 目录结构",
        "配置 manifest.json (Manifest V3)，包含必要的 permissions (storage, activeTab)",
        "配置 Vite 构建脚本，支持多入口 (popup, content, background)",
        "配置 TypeScript 和必要的类型定义 (@types/chrome)",
        "创建 src/popup/index.html 作为 popup 入口",
        "创建 src/content/index.ts 作为内容脚本入口",
        "创建 src/background/index.ts 作为 service worker 入口",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "completed: all acceptance criteria met, typecheck and lint pass"
    },
    {
      "id": "US-002",
      "title": "存储模块封装",
      "description": "作为开发者，我需要封装 Chrome Storage 操作，以便安全地存储配置和待保存内容。",
      "acceptanceCriteria": [
        "创建 src/storage/index.ts，封装 chrome.storage.local 和 chrome.storage.session",
        "实现配置存储接口：getConfig(), setConfig(url, token), clearConfig()",
        "实现待保存内容存储接口：getPendingItems(), addPendingItem(item), removePendingItem(id), clearPendingItems()",
        "定义 TypeScript 类型：Config, PendingItem, ExtractedContent",
        "所有存储操作都有错误处理",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "completed: storage module created with error handling, typecheck and lint pass"
    },
    {
      "id": "US-003",
      "title": "AIMO API 客户端",
      "description": "作为开发者，我需要封装 AIMO 后端 API 调用，以便在扩展中进行认证和数据操作。",
      "acceptanceCriteria": [
        "创建 src/api/aimo.ts，封装 AIMO API",
        "实现 login(username, password) 方法，返回 JWT token",
        "实现 createMemo(content, sourceUrl, attachmentIds?) 方法",
        "实现 uploadAttachment(file) 方法 (multipart/form-data)",
        "所有 API 调用自动添加 Authorization: Bearer token 请求头",
        "实现统一的错误处理和响应类型",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "completed: all acceptance criteria met, typecheck and lint pass"
    },
    {
      "id": "US-004",
      "title": "浮动工具栏（内容脚本）",
      "description": "作为用户，我在网页上选中文本或图片后，希望在选区附近看到保存按钮。",
      "acceptanceCriteria": [
        "监听 document.onselectionchange，获取选中文本",
        "监听图片点击事件，获取图片 URL",
        "创建浮动工具栏 DOM 元素（使用 shadow DOM 隔离样式）",
        "工具栏显示在选区/图片右下角，位置计算正确",
        "工具栏包含 AIMO 图标和 '保存' 文字按钮",
        "点击页面其他区域或滚动时工具栏自动隐藏",
        "点击保存按钮将内容存储到 session storage 并打开 popup",
        "支持浅色/深色主题（跟随系统偏好）",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 4,
      "passes": true,
      "notes": "completed: floating toolbar with shadow DOM, typecheck and lint pass"
    },
    {
      "id": "US-005",
      "title": "Popup 配置和登录页面",
      "description": "作为用户，我首次使用扩展时需要配置服务器地址和登录信息。",
      "acceptanceCriteria": [
        "创建 React 组件：ConfigPage.tsx",
        "配置表单包含：服务器 URL、用户名、密码三个字段",
        "表单有基本的输入验证（URL 格式、非空检查）",
        "点击登录按钮调用 API 获取 token",
        "登录成功保存配置到 storage，切换到主界面",
        "登录失败显示错误提示（中文错误信息）",
        "顶部有设置图标，可重新打开配置页面",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 5,
      "passes": true,
      "notes": "completed: ConfigPage with server URL, username, password form; form validation; login API integration; error handling in Chinese; settings icon to reopen config; typecheck and lint pass"
    },
    {
      "id": "US-006",
      "title": "Popup 内容列表和预览",
      "description": "作为用户，我需要在 popup 中查看已提取的内容列表，支持预览和编辑。",
      "acceptanceCriteria": [
        "创建 React 组件：ContentList.tsx, ContentItem.tsx",
        "主界面显示 '待保存内容' 列表，从 storage 读取",
        "每条内容显示：类型图标（文本/图片）、内容摘要（前 50 字）、来源页面标题",
        "支持单条删除，点击删除从列表移除",
        "文本内容可点击展开编辑（多行文本框）",
        "图片内容显示缩略图预览",
        "空列表时显示提示文案和快捷操作指引",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 6,
      "passes": true,
      "notes": "completed: ContentList and ContentItem components created with text editing and image preview, typecheck and lint pass"
    },
    {
      "id": "US-007",
      "title": "图片下载和上传功能",
      "description": "作为用户，我选中图片后，希望图片被下载并上传到 AIMO 服务器。",
      "acceptanceCriteria": [
        "实现图片 URL 解析（支持 <img> 标签和 background-image）",
        "使用 fetch 获取图片数据并转换为 Blob/File",
        "在 popup 中显示图片上传进度或加载状态",
        "调用 uploadAttachment API 上传图片",
        "上传成功后获取 attachment ID 并关联到 pending item",
        "上传失败时显示错误提示和重试按钮",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 7,
      "passes": true,
      "notes": "completed: background-image extraction, download and upload with progress, retry UI, typecheck and lint pass"
    },
    {
      "id": "US-008",
      "title": "保存到 AIMO 功能",
      "description": "作为用户，我希望将待保存的内容提交到 AIMO 服务器创建 memo。",
      "acceptanceCriteria": [
        "Popup 底部显示 '保存到 AIMO' 和 '取消' 按钮",
        "点击保存按钮遍历所有 pending items",
        "对每个文本项调用 createMemo API",
        "对有图片的项先确保图片已上传，再创建带 attachmentIds 的 memo",
        "显示保存进度（x/n 完成）",
        "全部保存成功后清空 pending items，显示成功提示",
        "保存失败的项目保留在列表中，可重试",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 8,
      "passes": true,
      "notes": "completed: save to AIMO with progress tracking, error handling, success message, typecheck and lint pass"
    },
    {
      "id": "US-009",
      "title": "扩展图标徽章和错误处理",
      "description": "作为用户，我希望在扩展遇到问题时得到清晰反馈，并看到待保存内容数量。",
      "acceptanceCriteria": [
        "实现 setBadge(count) 函数，在扩展图标显示未保存内容数量",
        "添加 pending item 时自动更新徽章",
        "清空列表时移除徽章",
        "未配置服务器时显示 '请先配置' 提示",
        "Token 过期时自动跳转到登录页面",
        "网络错误显示具体中文错误信息和重试按钮",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 9,
      "passes": false,
      "notes": ""
    }
  ]
}
