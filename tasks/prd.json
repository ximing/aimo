{
  "project": "AIMO",
  "branchName": "ralph/ai-explore-page",
  "description": "AI探索页面 - 基于LangChain DeepAgents的智能知识发现界面，用户可以基于已有笔记进行提问、探索和分析",
  "userStories": [
    {
      "id": "US-001",
      "title": "LangChain DeepAgents后端基础架构",
      "description": "作为开发者，我需要搭建基于LangChain的DeepAgents架构，实现多Agent协作处理用户查询",
      "acceptanceCriteria": [
        "安装langchain及相关依赖包",
        "创建ExploreService作为Agent协调器",
        "实现检索Agent，使用LanceDB向量搜索相关笔记",
        "定义Agent间状态传递的数据结构",
        "创建/explore API端点接收用户查询",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Implemented LangChain DeepAgents backend with ExploreService, retrieval/analysis/generation agents, and /explore API endpoint"
    },
    {
      "id": "US-002",
      "title": "实现关系分析Agent和附件理解Agent",
      "description": "作为开发者，我需要实现关系分析Agent和附件理解Agent，以便全面分析笔记关联和附件内容",
      "acceptanceCriteria": [
        "实现关系分析Agent，查询笔记间的关联关系",
        "实现附件理解Agent，提取图片/PDF的关键信息",
        "实现总结Agent，整合各Agent输出生成回答",
        "Agent间通过共享状态传递中间结果",
        "整个Agent链执行时间不超过5秒（不含LLM生成）",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Implemented relation analysis agent with backlink support and attachment understanding agent for images/PDFs. Summary agent now integrates all outputs. Parallel execution ensures sub-5s performance (excluding LLM)."
    },
    {
      "id": "US-003",
      "title": "对话界面基础架构",
      "description": "作为用户，我需要一个对话式界面来与AI交互，自然地提出关于笔记的问题",
      "acceptanceCriteria": [
        "创建AI探索页面路由/ai-explore",
        "实现可滚动的消息历史区域",
        "底部固定输入框，支持多行文本和Enter发送",
        "用户消息和AI消息有明显视觉区分",
        "支持Markdown渲染AI回复内容",
        "空状态显示引导性提示语",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Implemented AI exploration chat interface with message history, markdown rendering, source citations, and conversation management (10-round limit with localStorage persistence)"
    },
    {
      "id": "US-004",
      "title": "智能检索与来源标注",
      "description": "作为用户，我希望AI回答能显示引用了哪些笔记，以便验证信息来源",
      "acceptanceCriteria": [
        "AI回答下方以卡片形式展示引用的笔记",
        "来源卡片显示笔记标题、摘要、相似度分数",
        "点击来源卡片可跳转到对应笔记详情",
        "回答正文中引用以[1]、[2]形式标注",
        "无相关笔记时AI明确告知",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Implemented source citations with SourceCard component showing title, summary, relevance score. MarkdownWithCitations component parses [1], [2] patterns into clickable badges. MemoDetailModal opens when clicking sources. Shows '未找到相关笔记' when no sources found."
    },
    {
      "id": "US-005",
      "title": "多轮对话与上下文记忆",
      "description": "作为用户，我希望能进行追问和深入交流，逐步探索问题",
      "acceptanceCriteria": [
        "支持多轮对话，AI记住之前上下文",
        "实现'新建话题'按钮开启独立对话",
        "对话历史存储在localStorage",
        "单次对话限制10轮，超出提示新建话题",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Frontend: localStorage persistence, 10-round limit with UI warnings, 'New Conversation' button, context accumulation. Backend: Improved prompts for multi-turn dialogue with conversation history formatting."
    },
    {
      "id": "US-006",
      "title": "笔记关系图谱探索",
      "description": "作为用户，我希望AI能发现并展示笔记间的关联关系，理解知识结构",
      "acceptanceCriteria": [
        "AI能识别笔记间的主题关联、时间关联、标签关联",
        "回答中可选显示关系图谱小部件",
        "关系图谱支持点击节点查看笔记详情",
        "提供'探索相关'按钮基于当前话题深入探索",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 6,
      "passes": true,
      "notes": "Implemented relationship graph with thematic, temporal, outgoing, and incoming relationship detection. Graph widget with interactive nodes, expand/collapse, and explore-related functionality."
    },
    {
      "id": "US-007",
      "title": "探索建议和洞察生成",
      "description": "作为用户，我希望AI能主动给我洞察和建议，发现知识盲区",
      "acceptanceCriteria": [
        "提供'发现洞察'功能按钮",
        "AI分析全库笔记生成主题聚类、时间趋势",
        "洞察报告以结构化形式展示",
        "支持'告诉我更多'追问深入特定主题",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 7,
      "passes": false,
      "notes": ""
    }
  ]
}
