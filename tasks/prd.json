{
  "project": "AIMO",
  "branchName": "ralph/timed-notification",
  "description": "Timed Notification Feature - Allow users to schedule push notifications to MeoW channel with configurable time, content type, and adapter pattern for extensibility",
  "userStories": [
    {
      "id": "US-001",
      "title": "Create push_rules database table",
      "description": "As a developer, I need to create a database table to store user push rule configurations.",
      "acceptanceCriteria": [
        "Create push_rules table with fields: id, user_id, name, push_time, content_type, channels (JSON), enabled, created_at, updated_at",
        "Generate and run migration successfully",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Create push rules DTO and service layer",
      "description": "As a developer, I need to create DTOs and service layer for push rules to prepare for CRUD API.",
      "acceptanceCriteria": [
        "Create PushRuleDto in packages/dto/src",
        "Create PushChannelConfigDto for channel configuration (type, nickname, msgType, htmlHeight)",
        "Create push-rule.service.ts in apps/server/src/services",
        "Implement CRUD methods: create, findByUserId, update, delete",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Implement push rules REST API",
      "description": "As a frontend developer, I need REST API endpoints to manage push rules.",
      "acceptanceCriteria": [
        "POST /api/v1/push-rules - create push rule",
        "GET /api/v1/push-rules - list user's push rules",
        "PUT /api/v1/push-rules/:id - update push rule",
        "DELETE /api/v1/push-rules/:id - delete push rule",
        "Use Zod validation for request body",
        "Authenticate user and enforce ownership",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Create PushChannel interface and MeoW adapter",
      "description": "As a developer, I need to create an adapter pattern for push channels to support extensibility.",
      "acceptanceCriteria": [
        "Create PushChannel interface with send(options) method",
        "Create MeoWChannel class implementing PushChannel",
        "Implement send() to call api.chuckfang.com with POST request",
        "Handle nickname, msgType, htmlHeight, title, msg, url parameters",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Create ChannelFactory for adapter pattern",
      "description": "As a developer, I need a factory to create the appropriate channel adapter based on configuration.",
      "acceptanceCriteria": [
        "Create ChannelFactory class with getChannel(type) method",
        "Support 'meow' channel type",
        "Return MeoWChannel instance for meow type",
        "Throw error for unsupported channel types",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Create content generator for daily_pick",
      "description": "As a developer, I need a content generator that picks a memo to recommend.",
      "acceptanceCriteria": [
        "Create ContentGenerator interface with generate(contentType, userId) method",
        "Implement daily_pick: randomly select one memo from user's collection",
        "Return title and msg in HTML format",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Create content generator for daily_memos",
      "description": "As a developer, I need a content generator that collects today's memos.",
      "acceptanceCriteria": [
        "Implement daily_memos: get all memos created today",
        "Format as HTML list with titles",
        "Return title and msg in HTML format",
        "Handle empty state (no memos today)",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "Implement scheduled task runner",
      "description": "As a developer, I need a scheduler that runs push tasks at configured times.",
      "acceptanceCriteria": [
        "Use node-cron or node-schedule for scheduling",
        "Run every minute to check for pending pushes",
        "Match current hour with push_time in rules",
        "For each matched rule, generate content and send via configured channels",
        "Skip failed pushes and log errors",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "Add push rules API to frontend",
      "description": "As a frontend developer, I need to add API calls for push rules management.",
      "acceptanceCriteria": [
        "Create apps/web/src/api/push-rules.ts",
        "Implement createPushRule, getPushRules, updatePushRule, deletePushRule functions",
        "Match backend API response types",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "Create push rules list UI in settings",
      "description": "As a user, I want to see and manage my push rules in the settings page.",
      "acceptanceCriteria": [
        "Add '推送规则' section to settings page",
        "Display push rules in a list showing: name, push_time, content_type, channels, enabled",
        "Show add button to create new rule",
        "Show edit and delete buttons for each rule",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 10,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-011",
      "title": "Create push rule form modal",
      "description": "As a user, I want to create or edit a push rule with a form.",
      "acceptanceCriteria": [
        "Form fields: name (text), push_time (0-23 dropdown), content_type (radio), channels (checkbox)",
        "Enable/disable toggle for rule",
        "Validate: name required, at least one channel selected",
        "Submit creates/updates rule and closes modal",
        "Refresh list after save",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 11,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-012",
      "title": "Add MeoW channel configuration fields",
      "description": "As a user, I want to configure MeoW channel specific settings like nickname.",
      "acceptanceCriteria": [
        "When MeoW channel is selected, show nickname input",
        "Show msgType dropdown (text/html)",
        "Show htmlHeight number input (only when msgType=html)",
        "Save these settings in channels JSON",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 12,
      "passes": false,
      "notes": ""
    }
  ]
}
