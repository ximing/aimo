# Ralph Progress: Chrome Extension

Branch: ralph/chrome-extension-v1

## Status

## Notes

## Codebase Patterns
- Migrations are in apps/server/src/migrations/scripts/ and follow a numbered version pattern (e.g., 016-add-memo-source.ts)
- Each migration exports a Migration object with version, tableName, description, and up() function
- Register new migrations in apps/server/src/migrations/scripts/index.ts by importing and adding to ALL_MIGRATIONS array
- Use LanceDB's addColumns() to add new columns, with valueSql: 'CAST(NULL AS STRING)' to explicitly set Utf8 type
- Handle "already exists" errors gracefully by catching and returning early
---

## 2026-02-27 - US-001
- Added source?: string field to CreateMemoDto, MemoDto, MemoWithAttachmentsDto, and MemoListItemDto in packages/dto/src/memo.ts
- Rebuilt DTO package
- Typecheck passes
- **Learnings for future iterations:**
  - Memo DTOs are in packages/dto/src/memo.ts - all related interfaces (CreateMemoDto, MemoDto, MemoWithAttachmentsDto, MemoListItemDto) need to be updated together
  - After modifying DTOs, run `pnpm --filter @aimo/dto build` to regenerate types
  - Server typecheck requires logger package to be built first: `pnpm --filter @aimo/logger build`
---

## 2026-02-27 - US-002
- Added source field to memosSchema in apps/server/src/models/db/schema.ts using Arrow types (new Field('source', new Utf8(), true))
- Added source?: string to MemoRecord interface
- Typecheck passes
- **Learnings for future iterations:**
  - LanceDB schema is defined in apps/server/src/models/db/schema.ts
  - Schema uses Apache Arrow types (Schema, Field, Utf8, etc.)
  - Optional fields use nullable: true in the Field constructor
  - TypeScript interfaces mirror the schema fields for type safety
---

## 2026-02-27 - US-003
- Created migration script 016-add-memo-source.ts to add source column to memos table
- Migration uses LanceDB's addColumns() with valueSql: 'CAST(NULL AS STRING)' to add nullable source column
- Registered migration in index.ts (ALL_MIGRATIONS array)
- Typecheck passes
- **Learnings for future iterations:**
  - Migration version numbers continue from existing migrations (latest was 015)
  - Use try/catch to handle "already exists" errors gracefully
  - Migration will run automatically on server startup via the migration executor
---

## 2026-02-27 - US-004
- Updated memo.service.ts createMemo() to accept source parameter and include it in memo object
- Added source?: string to Memo interface in apps/server/src/models/db/memo.schema.ts
- Updated memo.controller.ts to pass memoData.source to service
- Typecheck passes
- **Learnings for future iterations:**
  - Memo interface in memo.schema.ts is separate from MemoRecord in schema.ts - need to update both
  - Controller passes DTO data directly to service createMemo method
---
